---
title: "tablas_contingencia"
author: "Alejandro Brenes y Paula Jimenez"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

```{r Descarga_base}
library(readxl)
Muertes_CR <- read_excel("C:/Users/Alejandro pc/Downloads/muertes_en_costa_rica_2014_2021.xlsx")
```

Se dejan las edades de 15 años o más.

```{r Nuevas_edades}
Muertes_CR <- Muertes_CR[Muertes_CR$edads >= 15, ]
```

Se remueven las observaciones de años anteriores a 2014, la base de datos tiene muy pocas.

```{r Nuevos_annos}
Muertes_CR <- Muertes_CR[Muertes_CR$anodef >= 2014, ]
Muertes_CR <- Muertes_CR[Muertes_CR$anotrab >= 2014, ]
Muertes_CR <- Muertes_CR[Muertes_CR$anodeclara >= 2014, ]
```

Se procede a corregir los errores ortográficos de las principales variables.

```{r Ortografia}
# Se podrá todo sin tílde, para evitar errores al correr el programa
Muertes_CR$estcivil <- gsub("Ã³", "o", Muertes_CR$estcivil)
Muertes_CR$ocuparec <- gsub("Ã¡", "a", Muertes_CR$ocuparec)
Muertes_CR$ocuparec <- gsub("Ã©", "e", Muertes_CR$ocuparec)
Muertes_CR$ocuparec <- gsub("Ã", "i", Muertes_CR$ocuparec)
Muertes_CR$regsalud <- gsub("Ã", "i", Muertes_CR$regsalud)
Muertes_CR$regsalud <- gsub("i³", "o", Muertes_CR$regsalud)
Muertes_CR$provincia <- gsub("Ã©", "e", Muertes_CR$provincia)
Muertes_CR$provincia <- gsub("Ã³", "o", Muertes_CR$provincia)
Muertes_CR$provocu <- gsub("Ã©", "e", Muertes_CR$provocu)
Muertes_CR$provocu <- gsub("Ã³", "o", Muertes_CR$provocu)
Muertes_CR$provregis <- gsub("Ã©", "e", Muertes_CR$provregis)
Muertes_CR$provregis <- gsub("Ã³", "o", Muertes_CR$provregis)
Muertes_CR$reginec <- gsub("Ã", "i", Muertes_CR$reginec)
Muertes_CR$reginec <- gsub("i³", "o", Muertes_CR$reginec)
Muertes_CR$edadsrec <- gsub("100 y mÃ¡s", "100 - 121", Muertes_CR$edadsrec)
Muertes_CR$autopsia <- gsub("Ã©", "e", Muertes_CR$autopsia)
Muertes_CR$autopsia <- gsub("Ã", "i", Muertes_CR$autopsia)
Muertes_CR$asistmed <- gsub("Ã©", "e", Muertes_CR$asistmed)
Muertes_CR$asistmed <- gsub("Ã", "i", Muertes_CR$asistmed)
Muertes_CR$reginec <- gsub("Paci­fico", "Pacifico", Muertes_CR$reginec)
Muertes_CR$regsalud <- gsub("Paci­fico", "Pacifico", Muertes_CR$regsalud)
```

Hay muchas nacionalidades en la base de datos, pero la mayoría son de Costa Rica, por lo que se juntará a las demás en un grupo llamado extranjeros.

```{r Nacionalidades}
# Acá se ve que hay muchas nacionalidades
(length(unique(Muertes_CR$nacionalid)))

# Se cambian todas las nacionalidades distintas de Costa Rica
Muertes_CR$nacionalid <- gsub("^(?!Costa Rica$).*", "Extranjero", Muertes_CR$nacionalid, perl = TRUE)
```
Debido a la baja cantidad de observaciones, en el estado civil se hará un grupo llamado "otros" para los que están en estado civil: ignorado, unión libre, menor y separado.

```{r Estado_civ}
Muertes_CR$estcivil <- gsub("Ignorado", "Otros", Muertes_CR$estcivil)
Muertes_CR$estcivil <- gsub("Union libre", "Otros", Muertes_CR$estcivil)
Muertes_CR$estcivil <- gsub("Separado", "Otros", Muertes_CR$estcivil)
Muertes_CR$estcivil <- gsub("Menor", "Otros", Muertes_CR$estcivil)
```

Nuevamente, por la baja cantidad de observaciones en algunas ocupaciones, se juntarán algunos grupos, en este caso se harán 2 grupos llamados "Trabajadores activos" y "Otros" que contienen a las siguientes ocupaciones:

Trabajadores activos: "Profesionales cientificos e intelectuales", "Agricultores y trabajadores calificados agropecuarios, forestales y pesqueros", "Ocupaciones elementales", "Trabajadores de los servicios y vendedores de comercios y mercados", "Operadores de instalaciones y maquinas y ensambladores", "Tecnicos y profesionales de nivel medio", "Oficiales, operarios y artesanos de artes mecanicas y de otros oficios", "Personal de apoyo administrativo" y "Directores y gerentes".

Otros: "Pensionado", "Persona con discapacidad", "Estudiante", "Mal especificadas" y "Privado de libertad"

```{r Ocupacion}
# Grupo de Trabajadores activos
Muertes_CR$ocuparec <- gsub("Profesionales cienti­ficos e intelectuales", "Trabajadores activos", Muertes_CR$ocuparec)
Muertes_CR$ocuparec <- gsub("Agricultores y trabajadores calificados agropecuarios, forestales y pesqueros", "Trabajadores activos", Muertes_CR$ocuparec)
Muertes_CR$ocuparec <- gsub("Ocupaciones elementales", "Trabajadores activos", Muertes_CR$ocuparec)
Muertes_CR$ocuparec <- gsub("Trabajadores de los servicios y vendedores de comercios y mercados", "Trabajadores activos", Muertes_CR$ocuparec)
Muertes_CR$ocuparec <- gsub("Operadores de instalaciones y maquinas y ensambladores", "Trabajadores activos", Muertes_CR$ocuparec)
Muertes_CR$ocuparec <- gsub("Tecnicos y profesionales de nivel medio", "Trabajadores activos", Muertes_CR$ocuparec)
Muertes_CR$ocuparec <- gsub("Oficiales, operarios y artesanos de artes mecanicas y de otros oficios", "Trabajadores activos", Muertes_CR$ocuparec)
Muertes_CR$ocuparec <- gsub("Personal de apoyo administrativo", "Trabajadores activos", Muertes_CR$ocuparec)
Muertes_CR$ocuparec <- gsub("Directores y gerentes", "Trabajadores activos", Muertes_CR$ocuparec)

# Grupo de otros
Muertes_CR$ocuparec <- gsub("Pensionado", "Otros", Muertes_CR$ocuparec)
Muertes_CR$ocuparec <- gsub("Persona con discapacidad", "Otros", Muertes_CR$ocuparec)
Muertes_CR$ocuparec <- gsub("Estudiante", "Otros", Muertes_CR$ocuparec)
Muertes_CR$ocuparec <- gsub("Mal especificadas", "Otros", Muertes_CR$ocuparec)
Muertes_CR$ocuparec <- gsub("Privado de libertad", "Otros", Muertes_CR$ocuparec)
```

```{r}

library(knitr)

tabla_1 <- table(Muertes_CR$grgruposcb, Muertes_CR$regsalud)
kable(tabla_1, caption = "")

tabla_2 <- table(Muertes_CR$grgruposcb, Muertes_CR$nacionalid)
kable(tabla_2, caption = "")

tabla_3 <- table(Muertes_CR$grgruposcb, Muertes_CR$sexo)
kable(tabla_3, caption = "")

tabla_4 <- table(Muertes_CR$grgruposcb, Muertes_CR$estcivil)
kable(tabla_4, caption = "")

tabla_5 <- table(Muertes_CR$grgruposcb, Muertes_CR$ocuparec)
kable(tabla_5, caption = "")

tabla_1_prop <- addmargins(prop.table(tabla_1, margin = 1)*100) 
kable(tabla_1_prop, caption = "")

tabla_2_prop <- addmargins(prop.table(tabla_2, margin = 1)*100) 
kable(tabla_2_prop, caption = "")

tabla_3_prop <- addmargins(prop.table(tabla_3, margin = 1)*100) 
kable(tabla_3_prop, caption = "")

tabla_4_prop <- addmargins(prop.table(tabla_4, margin = 1)*100) 
kable(tabla_4_prop, caption = "")

tabla_5_prop <- addmargins(prop.table(tabla_5, margin = 1)*100) 
kable(tabla_5_prop, caption = "")



```






